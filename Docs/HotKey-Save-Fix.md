# 热键保存功能使用说明

## 问题说明
用户反馈："录制热键之后没有保存功能"

## 问题原因
对话框高度设置过小（450px），导致底部的"保存"和"取消"按钮被遮挡，用户看不到保存按钮。

## 解决方案
✅ 已修复：将对话框高度增加到 550px，并允许调整大小

---

## 完整使用步骤

### 📝 添加新秘籍并保存热键

**步骤 1：打开添加对话框**
- 点击主窗口底部的 **"➕ 添加秘籍"** 按钮

**步骤 2：填写基本信息**
```
游戏类型：选择"魔兽争霸3"或"星际争霸1"
秘籍代码：输入秘籍代码（如 greedisgood）
描述：输入秘籍说明（如 获得500金和木材）
分类：选择或输入分类（如 资源）
启用该秘籍：勾选（默认已勾选）
```

**步骤 3：录制快捷键**
1. 找到 **"快捷键"** 部分（在"启用该秘籍"下方）
2. 点击热键输入框（显示 "点击录制热键..."）
3. 输入框背景变为蓝色
4. **按下组合键**，例如：
   - `Ctrl+F1`
   - `Alt+F1`
   - `Ctrl+Alt+F1`
   - `Shift+F2`
5. 输入框显示录制的热键（如 "Ctrl+F1"）

**步骤 4：保存秘籍**
1. **向下滚动或拉伸对话框**，找到底部的保存按钮
2. 点击 **蓝色的"保存"按钮**（在右下角）
3. 如果热键有冲突，会弹出提示对话框：
   ```
   ⚠️ 热键冲突

   热键 'Ctrl+F1' 已被秘籍 '魔兽3：greedisgood' 使用。

   是否移除原有绑定并使用新的绑定？

   [是(Y)]  [否(N)]
   ```
4. 选择处理方式：
   - **点击"是"** → 覆盖原有绑定，将热键绑定到新秘籍
   - **点击"否"** → 取消热键绑定，但秘籍仍会被保存

**步骤 5：确认保存成功**
- 状态栏显示：
  - 有热键：`"秘籍 'greedisgood' 已添加，热键 'Ctrl+F1' 已绑定"`
  - 无热键：`"秘籍 'greedisgood' 已添加"`

---

### ✏️ 编辑现有秘籍并修改热键

**步骤 1：选择秘籍**
- 在主窗口的秘籍列表中，点击要编辑的秘籍

**步骤 2：打开编辑对话框**
- 点击 **"✏ 编辑"** 按钮

**步骤 3：修改热键**
- 对话框自动显示当前热键（如 "Ctrl+F1"）
- 点击热键输入框重新录制新的组合键
- 或点击输入框右侧的 **✕ 按钮** 清除热键

**步骤 4：保存修改**
- 向下滚动找到 **"保存"** 按钮
- 点击保存
- 如有冲突，按提示处理

---

## 对话框布局说明

修复后的对话框布局（从上到下）：

```
┌────────────────────────────────────────┐
│  编辑秘籍                    [×]        │  ← 标题栏
├────────────────────────────────────────┤
│  游戏类型                              │
│  [魔兽争霸3 ▼]                         │
│                                        │
│  秘籍代码 *                            │
│  [greedisgood]                         │
│  示例: greedisgood 或 show me the money│
│                                        │
│  描述 *                                │
│  [获得500金和木材]                      │
│  简要说明该秘籍的作用                   │
│                                        │
│  分类                                  │
│  [资源 ▼]                              │
│                                        │
│  ☑ 启用该秘籍                          │
│                                        │
│  快捷键                                │
│  [Ctrl+F1          ✕]  💡             │
│  点击输入框后按下组合键（如 Ctrl+Alt+F1）│
│                                        │
│  ← 这里可以显示验证消息                 │
│                                        │
├────────────────────────────────────────┤
│                      [保存]  [取消]     │  ← 保存按钮
└────────────────────────────────────────┘
```

**关键改进：**
- ✅ 对话框高度：450px → **550px**
- ✅ 最小高度：**550px**（防止内容被遮挡）
- ✅ 允许调整大小：**CanResize**（用户可以拉伸）

---

## 保存位置

热键配置会自动保存到以下文件：

**热键绑定文件：**
```
GameCheatHelper/Data/DefaultHotKeys.json
```

**文件内容示例：**
```json
{
  "id": 1,
  "cheatCodeId": "wc3_greedisgood",
  "key": "F1",
  "modifiers": 2,  // Ctrl = 2, Alt = 1, Shift = 4
  "description": "魔兽3: greedisgood"
}
```

**秘籍数据文件：**
```
GameCheatHelper/Data/DefaultCheats.json
```

---

## 常见问题

### Q1: 看不到保存按钮怎么办？
**A:**
1. 向下滚动对话框
2. 或拉伸对话框（鼠标拖动边框）
3. 保存按钮在最下方，蓝色背景，白色文字

### Q2: 点击保存后没有反应？
**A:** 检查是否填写了必填项：
- ✅ 秘籍代码（必填）
- ✅ 描述（必填）
- ❌ 快捷键（可选）

如果缺少必填项，会在对话框中显示红色错误消息。

### Q3: 热键是否必须设置？
**A:** 不是必须的。
- 可以不设置热键，直接保存秘籍
- 以后可以随时编辑秘籍添加热键

### Q4: 如何清除已设置的热键？
**A:**
1. 编辑秘籍
2. 点击热键输入框右侧的 **✕ 按钮**
3. 点击保存

### Q5: 热键配置什么时候生效？
**A:**
- **游戏未运行时**：下次启动游戏时生效
- **游戏正在运行时**：立即生效（自动重新注册）

---

## 测试步骤

请按以下步骤测试保存功能：

### 测试 1：添加新秘籍
1. ✅ 点击"添加秘籍"
2. ✅ 填写信息并录制热键 `Ctrl+F6`
3. ✅ 向下滚动，找到并点击"保存"按钮
4. ✅ 确认状态栏显示成功消息
5. ✅ 检查 `Data/DefaultHotKeys.json` 文件中是否有新增记录

### 测试 2：热键冲突
1. ✅ 添加新秘籍，使用已存在的热键 `Ctrl+F1`
2. ✅ 点击保存
3. ✅ 确认弹出冲突提示对话框
4. ✅ 点击"是"，确认原有绑定被覆盖
5. ✅ 检查 JSON 文件，确认热键已更新

### 测试 3：清除热键
1. ✅ 编辑已有秘籍
2. ✅ 点击热键输入框的 ✕ 按钮
3. ✅ 点击保存
4. ✅ 确认 JSON 文件中该秘籍的热键记录被删除

---

## 修改文件清单

| 文件 | 修改内容 | 状态 |
|------|---------|------|
| `Views/CheatEditDialog.xaml` | 增加对话框高度 450→550px | ✅ 已修复 |
| `Views/CheatEditDialog.xaml` | 允许调整大小 CanResize | ✅ 已修复 |
| `ViewModels/MainViewModel.cs` | 添加热键冲突检测逻辑 | ✅ 已完成 |
| `ViewModels/MainViewModel.cs` | 实现热键自动保存 | ✅ 已完成 |

---

**修复版本**: v1.1-hotkey-save-fix
**修复日期**: 2026-02-01
**状态**: ✅ 已修复，请重新运行测试
